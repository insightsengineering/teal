% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/FilterState.R
\docType{class}
\name{FilterState}
\alias{FilterState}
\title{Abstract class to encapsulate filter states}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}
}
\details{
This class is responsible for managing single filter item within
\code{FilteredData} class. Filter states depend on the variable type:
(\code{logical}, \code{integer}, \code{numeric}, \code{factor}, \code{character}, \code{Date}, \code{POSIXct}, \code{POSIXlt})
and returns \code{FilterState} object with class corresponding to input variable.
Class controls single filter entry in \code{module_single_filter_item} and returns
code relevant to selected values.
\itemize{
\item \code{factor}, \code{character}: \code{class = ChoicesFilterState}
\item \code{numeric}: \code{class = RangeFilterState}
\item \code{logical}: \code{class = LogicalFilterState}
\item \code{Date}: \code{class = DateFilterState}
\item \code{POSIXct}, \code{POSIXlt}: \code{class = DatetimeFilterState}
\item all \code{NA} entries: \code{class: FilterState}, cannot be filtered
\item default: \code{FilterState}, cannot be filtered
Each variable's filter state is an \code{R6} object which contains \code{choices},
\code{selected}, \code{varname}, \code{dataname}, \code{labels}, \code{na_count}, \code{keep_na} and other
variable type specific fields (\code{keep_inf}, \code{inf_count}, \code{timezone}).
Object contains also shiny module (\code{ui} and \code{server}) which manages
state of the filter through reactive values \code{selected}, \code{keep_na}, \code{keep_inf}
which trigger \code{get_call()} and every R function call up in reactive
chain.
\cr
\cr
\if{html}{\figure{filter_state_reactivity.jpg}{options: width="100\%" alt="Figure: filter_state_reactivity.jpg"}}
\if{latex}{\figure{filter_state_reactivity.jpg}{options: width=7cm}}
Modifying a \code{FilterState} object is possible in three scenarios depicted above:
}
\itemize{
\item In the interactive session by directly specifying values of \code{selected},
\code{keep_na} or \code{keep_inf} using \code{set_state} method (to update all at once),
or using \code{set_selected}, \code{set_keep_na} or \code{set_keep_inf}
\item In a \code{teal} application by changing appropriate inputs
\item Using methods \code{set_selected_reactive}, \code{set_keep_na_reactive},
\code{set_keep_inf_reactive} which serves as a programmatic API.
}
}
\keyword{internal}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-new}{\code{FilterState$new()}}
\item \href{#method-destroy_observers}{\code{FilterState$destroy_observers()}}
\item \href{#method-get_call}{\code{FilterState$get_call()}}
\item \href{#method-get_dataname}{\code{FilterState$get_dataname()}}
\item \href{#method-get_keep_na}{\code{FilterState$get_keep_na()}}
\item \href{#method-get_varlabel}{\code{FilterState$get_varlabel()}}
\item \href{#method-get_varname}{\code{FilterState$get_varname()}}
\item \href{#method-get_selected}{\code{FilterState$get_selected()}}
\item \href{#method-get_state}{\code{FilterState$get_state()}}
\item \href{#method-set_keep_na}{\code{FilterState$set_keep_na()}}
\item \href{#method-set_keep_na_reactive}{\code{FilterState$set_keep_na_reactive()}}
\item \href{#method-set_na_rm}{\code{FilterState$set_na_rm()}}
\item \href{#method-set_selected}{\code{FilterState$set_selected()}}
\item \href{#method-set_selected_reactive}{\code{FilterState$set_selected_reactive()}}
\item \href{#method-set_state}{\code{FilterState$set_state()}}
\item \href{#method-set_state_reactive}{\code{FilterState$set_state_reactive()}}
\item \href{#method-server}{\code{FilterState$server()}}
\item \href{#method-ui}{\code{FilterState$ui()}}
\item \href{#method-clone}{\code{FilterState$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-new"></a>}}
\if{latex}{\out{\hypertarget{method-new}{}}}
\subsection{Method \code{new()}}{
Initialize a \code{FilterState} object
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$new(
  x,
  varname,
  varlabel = character(0),
  input_dataname = NULL,
  extract_type = character(0)
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{(\code{vector})\cr
values of the variable used in filter}

\item{\code{varname}}{(\code{character}, \code{name})\cr
name of the variable}

\item{\code{varlabel}}{(\code{character(1)})\cr
label of the variable (optional).}

\item{\code{input_dataname}}{(\code{name} or \code{call})\cr
name of dataset where \code{x} is taken from. Must be specified if \code{extract_type} argument
is not empty.}

\item{\code{extract_type}}{(\code{character(0)}, \code{character(1)})\cr
whether condition calls should be prefixed by dataname. Possible values:
\itemize{
\item{\code{character(0)} (default)}{ \code{varname} in the condition call will not be prefixed}
\item{\code{"list"}}{ \code{varname} in the condition call will be returned as \verb{<input_dataname>$<varname>}}
\item{\code{"matrix"}}{ \code{varname} in the condition call will be returned as \verb{<input_dataname>[, <varname>]}}
}}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-destroy_observers"></a>}}
\if{latex}{\out{\hypertarget{method-destroy_observers}{}}}
\subsection{Method \code{destroy_observers()}}{
Destroy observers stored in \code{private$observers}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$destroy_observers()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_call"></a>}}
\if{latex}{\out{\hypertarget{method-get_call}{}}}
\subsection{Method \code{get_call()}}{
Returns reproducible condition call for current selection relevant
for selected variable type.
Method is using internal reactive values which makes it reactive
and must be executed in reactive or isolated context.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_call()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_dataname"></a>}}
\if{latex}{\out{\hypertarget{method-get_dataname}{}}}
\subsection{Method \code{get_dataname()}}{
Returns dataname
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_dataname(deparse = TRUE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deparse}}{(\code{logical(1)})\cr
whether dataname should be deparsed. \code{TRUE} by default}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
(\code{name} or \code{character(1)})
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_keep_na"></a>}}
\if{latex}{\out{\hypertarget{method-get_keep_na}{}}}
\subsection{Method \code{get_keep_na()}}{
Returns current \code{keep_na} selection
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_keep_na()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
(\code{logical(1)})
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_varlabel"></a>}}
\if{latex}{\out{\hypertarget{method-get_varlabel}{}}}
\subsection{Method \code{get_varlabel()}}{
Returns variable label
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_varlabel()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
(\code{character(1)})
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_varname"></a>}}
\if{latex}{\out{\hypertarget{method-get_varname}{}}}
\subsection{Method \code{get_varname()}}{
Get variable name
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_varname(deparse = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deparse}}{(\code{logical(1)})\cr
whether variable name should be deparsed. \code{FALSE} by default}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
(\code{name} or \code{character(1)})
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_selected"></a>}}
\if{latex}{\out{\hypertarget{method-get_selected}{}}}
\subsection{Method \code{get_selected()}}{
Get selected values from \code{FilterState}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_selected()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
class of the returned object depends of class of the \code{FilterState}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-get_state"></a>}}
\if{latex}{\out{\hypertarget{method-get_state}{}}}
\subsection{Method \code{get_state()}}{
Returns the filtering state.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$get_state()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
\code{list} containing values taken from the reactive fields:
\itemize{
\item \code{selected} (\code{atomic}) length depends on a \code{FilterState} variant.
\item \code{keep_na} (\code{logical(1)}) whether \code{NA} should be kept.
}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_keep_na"></a>}}
\if{latex}{\out{\hypertarget{method-set_keep_na}{}}}
\subsection{Method \code{set_keep_na()}}{
Set if \code{NA} should be kept
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_keep_na(value)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{value}}{(\code{logical(1)})\cr
value(s) which come from the filter selection. Value is set in \code{server}
modules after selecting check-box-input in the shiny interface. Values are set to
\code{private$keep_na} which is reactive.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_keep_na_reactive"></a>}}
\if{latex}{\out{\hypertarget{method-set_keep_na_reactive}{}}}
\subsection{Method \code{set_keep_na_reactive()}}{
Set if \code{NA} should be kept when using \code{set_filter_state}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_keep_na_reactive(value)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{value}}{(\code{logical(1)})\cr
value(s) which come from the filter selection. Value is set in \code{server}
modules when using \code{set_filter_state} instead of the shiny interface. Values are set to
\code{private$keep_na_reactive} which is reactive.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_na_rm"></a>}}
\if{latex}{\out{\hypertarget{method-set_na_rm}{}}}
\subsection{Method \code{set_na_rm()}}{
Some methods needs additional \code{!is.na(varame)} condition to not include
missing values. When \code{private$na_rm = TRUE} is set, \code{self$get_call} returns
condition extended by \code{!is.na} condition.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_na_rm(value)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{value}}{(\code{logical(1)}) when \code{TRUE}, \code{FilterState$get_call} appends an expression
removing \code{NA} values to the filter expression returned by \code{get_call}}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_selected"></a>}}
\if{latex}{\out{\hypertarget{method-set_selected}{}}}
\subsection{Method \code{set_selected()}}{
Set selection
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_selected(value)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{value}}{(\code{vector})\cr
value(s) which come from the filter selection. Values are set in \code{server}
module after choosing value in app interface. Values are set to
\code{private$selected} which is reactive. Values type have to be the
same as \code{private$choices}.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_selected_reactive"></a>}}
\if{latex}{\out{\hypertarget{method-set_selected_reactive}{}}}
\subsection{Method \code{set_selected_reactive()}}{
Set selection when using \code{set_filter_state}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_selected_reactive(value)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{value}}{(\code{vector})\cr
value(s) which come from the filters set by the user. Values are set in \code{server}
modules after setting filters in \code{set_filter_state}. Values are set to
\code{private$set_selected_reactive} which is reactive. Values type have to be the
same as \code{private$choices}.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_state"></a>}}
\if{latex}{\out{\hypertarget{method-set_state}{}}}
\subsection{Method \code{set_state()}}{
Set state
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_state(state)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{state}}{(\code{list})\cr
contains fields relevant for a specific class
\itemize{
\item{\code{selected}}{ defines initial selection}
\item{\code{keep_na} (\code{logical})}{ defines whether to keep or remove \code{NA} values}
}}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-set_state_reactive"></a>}}
\if{latex}{\out{\hypertarget{method-set_state_reactive}{}}}
\subsection{Method \code{set_state_reactive()}}{
Set state when using \code{set_filter_state}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$set_state_reactive(state)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{state}}{(\code{list})\cr
contains fields relevant for a specific class
\itemize{
\item{\code{selected}}{ defines initial selection}
\item{\code{keep_na} (\code{logical})}{ defines whether to keep or remove \code{NA} values}
}}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-server"></a>}}
\if{latex}{\out{\hypertarget{method-server}{}}}
\subsection{Method \code{server()}}{
Server module
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$server(id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{id}}{(\code{character(1)})\cr
an ID string that corresponds with the ID used to call the module's UI function.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
\code{moduleServer} function which returns \code{NULL}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ui"></a>}}
\if{latex}{\out{\hypertarget{method-ui}{}}}
\subsection{Method \code{ui()}}{
UI Module
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$ui(id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{id}}{(\code{character(1)})\cr
id of shiny element. UI for this class contains simple message
informing that it's not supported
description
Adds \code{is.na(varname)} before existing condition calls if \code{keep_na} is selected.
Otherwise, if missings are found in the variable \code{!is.na} will be added
only if \code{private$na_rm = TRUE}
return (\code{call})
description
Prefixed (or not) variable

Return variable name needed to condition call.
If \code{isTRUE(private$use_dataset)} variable is prefixed by
dataname to be evaluated as extracted object, for example
\code{data$var}
return (\code{name} or \code{call})
Sets \code{keep_na} field according to observed \code{input$keep_na}
If \code{keep_na = TRUE} \code{is.na(varname)} is added to the returned call.
Otherwise returned call excludes \code{NA} when executed.
Sets \code{keep_na} field according to \code{keep_na} value passed in \code{set_filter_state}.
If \code{keep_na = TRUE} \code{is.na(varname)} is added to the returned call.
Otherwise returned call excludes \code{NA} when executed.
Set choices

Set choices is supposed to be executed once in the constructor
to define set/range which selection is made from.
parameter choices (\code{vector})\cr
class of the vector depends on the \code{FilterState} class.
return a \code{NULL}}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-clone"></a>}}
\if{latex}{\out{\hypertarget{method-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{FilterState$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
