<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Custom Modules • teal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Custom Modules">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">teal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.16.0.9008</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started-with-teal.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Get started</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-started-with-teal.html">Getting Started with teal</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Data in `teal` apps</h6></li>
    <li><a class="dropdown-item" href="../articles/including-data-in-teal-applications.html">Including Data in teal Applications</a></li>
    <li><a class="dropdown-item" href="../articles/data-as-shiny-module.html">Data as shiny Module</a></li>
    <li><a class="dropdown-item" href="../articles/filter-panel.html">Filter Panel</a></li>
    <li><a class="dropdown-item" href="../articles/transform-input-data.html">Transform Input Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending `teal`</h6></li>
    <li><a class="dropdown-item" href="../articles/creating-custom-modules.html">Creating Custom Modules</a></li>
    <li><a class="dropdown-item" href="../articles/adding-support-for-reporting.html">Adding Support for Reporting to Custom Modules</a></li>
    <li><a class="dropdown-item" href="../articles/transform-module-output.html">Transform Module Output</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Using `teal`</h6></li>
    <li><a class="dropdown-item" href="../articles/teal-as-a-shiny-module.html">Teal as a Shiny Module</a></li>
    <li><a class="dropdown-item" href="../articles/teal-options.html">Modifying a teal Application With R Options</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrap-themes-in-teal.html">Bootstrap Themes in teal</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-blueprint" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical blueprint</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-blueprint">
<li><a class="dropdown-item" href="../articles/blueprint/index.html">About blueprint</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/actors.html">Actors</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/dataflow.html">Data flow</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/product_map.html">Product map</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Features</h6></li>
    <li><a class="dropdown-item" href="../articles/blueprint/input_data.html">Input data</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/in_app_data.html">In-app data</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/filter_panel.html">Filter panel</a></li>
    <li><a class="dropdown-item" href="../articles/blueprint/module_encapsulation.html">Module and encapsulation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/teal" aria-label="View on Github"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Creating Custom Modules</h1>
                        <h4 data-toc-skip class="author">NEST
CoreDev</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/teal/blob/main/vignettes/creating-custom-modules.Rmd" class="external-link"><code>vignettes/creating-custom-modules.Rmd</code></a></small>
      <div class="d-none name"><code>creating-custom-modules.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>teal</code> framework provides a large catalog of
plug-in-ready analysis modules that can be incorporated into
<code>teal</code> applications. However, it is also possible to create
your own modules using the <code>module</code> function, which leverages
<code>shiny</code> modules. Each custom teal module is built as a <a href="https://shiny.posit.co/r/articles/improve/modules/" class="external-link"><code>shiny</code>
module</a>, combining <code>shiny</code>’s reactive capabilities with
modularized UI and server logic to encapsulate functionality. This
design enables a structured and reusable approach to creating
interactive components that integrate seamlessly within the teal
ecosystem.</p>
<p>In this guide, we will use the simple histogram below as an example,
and demonstrate how to convert this histogram function into a robust
<code>teal</code> module step-by-step:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset</span><span class="op">[[</span><span class="va">vars</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Histogram of"</span>, <span class="va">vars</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>  border <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This module will allow users to dynamically select datasets and
variables to create histograms within a <code>teal</code> application.
We will cover best practices, including:</p>
<ul>
<li>Setting up dynamic inputs.</li>
<li>Structuring server logic.</li>
<li>Using the <code>teal_data</code> object to ensure reactivity and
reproducibility.</li>
</ul>
</div>
<div class="section level2">
<h2 id="understanding-the-inputs-and-requirements">Understanding the Inputs and Requirements<a class="anchor" aria-label="anchor" href="#understanding-the-inputs-and-requirements"></a>
</h2>
<p>When developing a custom <code>teal</code> module for visualizations,
we will first identify the primary inputs that users will interact
with:</p>
<ul>
<li>
<strong>Dataset Input</strong> (<code>dataset</code>): Allows users
to select which dataset to explore.</li>
<li>
<strong>Variable Input</strong> (<code>vars</code>): Allows users to
choose a specific numeric variable from the chosen dataset, ensuring
only appropriate columns are available for plotting.</li>
</ul>
<p>These inputs are dynamically populated based on the available
datasets and variables in the <code>teal_data</code> object, which we
will cover later.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-teal-module-ui">Setting Up the <code>teal</code> Module UI<a class="anchor" aria-label="anchor" href="#setting-up-the-teal-module-ui"></a>
</h2>
<p>The UI function defines the controls and display area for the
histogram. For this module, we will use:</p>
<ul>
<li>
<strong><code>selectInput</code> for Dataset</strong>: Enables users
to select a dataset from the list of available datasets.</li>
<li>
<strong><code>selectInput</code> for Variable</strong>: Allows users
to choose a numeric variable from the chosen dataset, dynamically
filtering out any non-numeric variables from the choices.</li>
<li>
<strong><code>plotOutput</code> for Histogram</strong>: Displays the
histogram once both dataset and variable inputs are selected.</li>
<li>
<strong><code>verbatimTextOutput</code> for Code</strong>:
Automatically displays code that generated the plot based on the user
input.</li>
</ul>
<p>Here’s the code for the <code>histogram_module_ui</code>
function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/teal/">teal</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># UI function for the custom histogram module</span></span>
<span><span class="va">histogram_module_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>    <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span></span>
<span>      <span class="fu">ns</span><span class="op">(</span><span class="st">"dataset"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Select Dataset"</span>,</span>
<span>      choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iris"</span>, <span class="st">"mtcars"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span></span>
<span>      <span class="fu">ns</span><span class="op">(</span><span class="st">"variable"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Select Variable"</span>,</span>
<span>      choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html" class="external-link">plotOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"histogram_plot"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"plot_code"</span><span class="op">)</span><span class="op">)</span> <span class="co"># To display the reactive plot code</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-the-teal-module-server">Setting Up the <code>teal</code> Module Server<a class="anchor" aria-label="anchor" href="#setting-up-the-teal-module-server"></a>
</h2>
<p>The server function is where the main logic of a <code>teal</code>
module is handled. For our histogram module, the server function will
handle user interactions and manage the reactive <code>teal_data</code>
object, which allows the module to dynamically respond to user
inputs.</p>
<div class="section level3">
<h3 id="passing-the-data-argument-to-the-server-function">Passing the <code>data</code> Argument to the Server Function<a class="anchor" aria-label="anchor" href="#passing-the-data-argument-to-the-server-function"></a>
</h3>
<p>To begin, it’s essential to include the <code>data</code> argument in
the server function definition.</p>
<p>This <code>data</code> argument holds the reactive
<code>teal_data</code> object, which contains your datasets after
applying any active filtering by the filter panel. By including
<code>data</code>, we can ensure:</p>
<ul>
<li>The server function receives a reactive version of
<code>teal_data</code>, allowing it to automatically respond to
changes.</li>
<li>The server can access the filtered datasets directly.</li>
</ul>
<p>The correct function definition for the server function is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">histogram_module_server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Server logic goes here</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you need a refresher on the <code>teal_data</code> object, please
visit the <a href="https://insightsengineering.github.io/teal.data/latest-tag/articles/teal-data.html">teal.data
package documentation</a>.</p>
</div>
<div class="section level3">
<h3 id="understanding-teal_data-as-a-reactive-object-in-server-logic">Understanding <code>teal_data</code> as a Reactive Object in Server
Logic<a class="anchor" aria-label="anchor" href="#understanding-teal_data-as-a-reactive-object-in-server-logic"></a>
</h3>
<p>When used in the server logic of a <code>teal</code> module, the
<code>teal_data</code> object becomes a <strong>reactive data
container</strong>. This means that to access its contents, you need to
call it like a function, using parentheses: <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>.</p>
<p>This syntax triggers reactivity, ensuring that the data within
<code>teal_data</code> stays up-to-date with any filters or changes
applied elsewhere in the application.</p>
<blockquote>
<p><strong>Note</strong>: The <code>teal_data</code> object behaves as a
reactive data container only when used within the server logic. If
accessed outside of the server, it will not be reactive.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="using-names-to-access-dataset-names-in-teal_data-object">Using <code>names()</code> to Access Dataset Names in
<code>teal_data</code> object<a class="anchor" aria-label="anchor" href="#using-names-to-access-dataset-names-in-teal_data-object"></a>
</h3>
<p>The <code>teal_data</code> object can contain multiple datasets. To
retrieve the names of these datasets, use the <code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code>
function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This will return a character vector of the dataset names contained in
<code>teal_data</code>. You can then use these names to dynamically
populate input controls, like a dataset selection drop-down.</p>
</div>
<div class="section level3">
<h3 id="accessing-specific-datasets-with-double-brackets">Accessing Specific Datasets with Double Brackets
(<code>[[ ]])</code><a class="anchor" aria-label="anchor" href="#accessing-specific-datasets-with-double-brackets"></a>
</h3>
<p>To access an individual dataset from <code>teal_data</code>, use
double brackets (<code>[[ ]]</code>) along with the dataset name. This
allows you to extract the specific dataset as a data frame:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Here, <code>input$dataset</code> represents the name of the dataset
selected by the user. This syntax is highly flexible because it
dynamically references whichever dataset the user has chosen. You can
further subset or manipulate this extracted data frame as needed.</p>
</div>
<div class="section level3">
<h3 id="setting-up-server-logic-using-teal_data-and-dynamic-variable-injection">Setting Up Server Logic Using <code>teal_data</code> and Dynamic
Variable Injection<a class="anchor" aria-label="anchor" href="#setting-up-server-logic-using-teal_data-and-dynamic-variable-injection"></a>
</h3>
<p>In this updated server function, we will perform the following:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Create <code>new_data</code></strong> as a modified version
of <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code> using <code><a href="../reference/teal_data_module.html">within()</a></code>, dynamically
injecting <code>input$dataset</code> and
<code>input$variable</code>.</li>
<li>
<strong>Render the Plot</strong>: <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot()</a></code> displays
the plot by referencing the plot stored in the updated
<code>teal_data</code> object, <code>new_data</code>.</li>
</ol>
<p>Here’s the code:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Server function for the custom histogram module with injected variables in within()</span></span>
<span><span class="va">histogram_module_server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Update dataset choices based on available datasets in teal_data</span></span>
<span>    <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html" class="external-link">updateSelectInput</a></span><span class="op">(</span></span>
<span>        <span class="va">session</span>,</span>
<span>        <span class="st">"dataset"</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Update variable choices based on selected dataset, only including numeric variables</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span><span class="op">)</span> <span class="co"># Ensure dataset is selected</span></span>
<span>      <span class="va">numeric_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span><span class="op">]</span><span class="op">]</span>, <span class="va">is.numeric</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html" class="external-link">updateSelectInput</a></span><span class="op">(</span><span class="va">session</span>, <span class="st">"variable"</span>, choices <span class="op">=</span> <span class="va">numeric_vars</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Create a reactive `teal_data` object with the histogram plot</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span>, <span class="va">input</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span> <span class="co"># Ensure both dataset and variable are selected</span></span>
<span></span>
<span>      <span class="co"># Create a new teal_data object with the histogram plot</span></span>
<span>      <span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/teal_data_module.html">within</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="op">{</span></span>
<span>          <span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>            <span class="va">input_dataset</span><span class="op">[[</span><span class="va">input_vars</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Histogram of"</span>, <span class="va">input_vars</span><span class="op">)</span>,</span>
<span>            xlab <span class="op">=</span> <span class="va">input_vars</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>            border <span class="op">=</span> <span class="st">"black"</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        input_dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataset</span><span class="op">)</span>, <span class="co"># Replace `input_dataset` with input$dataset</span></span>
<span>        input_vars <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">variable</span> <span class="co"># Replace `input_vars` with input$variable</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">new_data</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Render the histogram from the updated teal_data object</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">histogram_plot</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">result</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"my_plot"</span><span class="op">]</span><span class="op">]</span> <span class="co"># Access and render the plot stored in `new_data`</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Reactive expression to get the generated code for the plot</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">plot_code</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/teal.code/latest-tag/reference/get_code.html">get_code</a></span><span class="op">(</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Retrieve and display the code for the updated `teal_data` object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s review what we’ve done so far:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Dynamic Variable Injection with
<code><a href="../reference/teal_data_module.html">within()</a></code></strong>:
<ul>
<li>
<code>input_dataset = as.name(input$dataset)</code> passes the
dataset name dynamically as <code>input_dataset</code>.</li>
<li>
<code>input_vars = input$variable</code> passes the selected
variable name directly as <code>input_vars</code>.</li>
<li>Inside <code><a href="../reference/teal_data_module.html">within()</a></code>, <code>my_plot</code> uses these
injected variables to dynamically generate the histogram plot.</li>
</ul>
</li>
<li>
<strong>Rendering the Plot</strong>:
<ul>
<li>
<code>output$histogram_plot</code> uses <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot()</a></code> to
display the plot stored in <code>new_data</code> by referencing
<code>result()[["my_plot"]]</code>.</li>
</ul>
</li>
<li>
<strong>Plot Code Display</strong>:
<ul>
<li>The <code>output$plot_code</code> render function displays the
dynamically generated code using
<code>teal.code::get_code(result())</code>, allowing users to see the
exact code used to generate the plot reactively.</li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="creating-the-custom-teal-module-function">Creating the Custom <code>teal</code> Module Function<a class="anchor" aria-label="anchor" href="#creating-the-custom-teal-module-function"></a>
</h2>
<p>The <code><a href="../reference/teal_modules.html">teal::module()</a></code> function allows you to encapsulate
your UI and server logic into a <code>teal</code> module, making it
reusable and ready to integrate into any <code>teal</code>
application.</p>
<p>By setting <code>datanames = "all"</code>, you give the module access
to all datasets specified in the <code>teal_data</code> object. Datasets
which names start with <code>.</code> won’t be included (see <a href="including-data-in-teal-applications.html#hidden-datasets">Hidden
datasets</a> section).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom histogram module creation</span></span>
<span><span class="va">create_histogram_module</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">label</span> <span class="op">=</span> <span class="st">"Histogram Module"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">teal</span><span class="fu">::</span><span class="fu"><a href="../reference/teal_modules.html">module</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="va">label</span>,</span>
<span>    ui <span class="op">=</span> <span class="va">histogram_module_ui</span>,</span>
<span>    server <span class="op">=</span> <span class="va">histogram_module_server</span>,</span>
<span>    datanames <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="integrating-the-custom-teal-module-into-a-teal-app">Integrating the Custom <code>teal</code> Module into a
<code>teal</code> App<a class="anchor" aria-label="anchor" href="#integrating-the-custom-teal-module-into-a-teal-app"></a>
</h2>
<p>With the custom <code>teal</code> module set up, it can now be
integrated into a <code>teal</code> app. We’ll use <code><a href="../reference/init.html">init()</a></code>
from <code>teal</code> to specify the datasets and modules used in the
app, then run the app to test the newly created module.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define datasets in `teal_data`</span></span>
<span><span class="va">data_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/teal.data/latest-tag/reference/teal_data.html">teal_data</a></span><span class="op">(</span></span>
<span>  iris <span class="op">=</span> <span class="va">iris</span>,</span>
<span>  mtcars <span class="op">=</span> <span class="va">mtcars</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the teal app</span></span>
<span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init.html">init</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_obj</span>,</span>
<span>  modules <span class="op">=</span> <span class="fu"><a href="../reference/teal_modules.html">modules</a></span><span class="op">(</span><span class="fu">create_histogram_module</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the app</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="va">ui</span>, server <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="va">server</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Congratulations! You just created a custom teal module and
used it in a teal app!</strong></p>
<p>This setup provides a fully dynamic, user-controlled
<code>teal</code> module that allows for interactive data exploration
and code visibility, enhancing both usability and transparency.</p>
<iframe src="https://shinylive.io/r/app/#code=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" width="150%" height="800px" data-external="1" style="position: relative; z-index:1">
</iframe>
</div>
<div class="section level2">
<h2 id="whats-next">What’s next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h2>
<p>Now that you’ve mastered the essentials of building and integrating
modules in <code>teal</code>, you’re ready to explore more advanced
features. <code>teal</code> offers a wide range of capabilities to
enhance your module’s functionality and user experience.</p>
<div class="section level3">
<h3 id="adding-reporting-to-a-module">Adding reporting to a module<a class="anchor" aria-label="anchor" href="#adding-reporting-to-a-module"></a>
</h3>
<p>Enhance your custom <code>teal</code> module with reporting features!
Dive into <a href="adding-support-for-reporting.html">this vignette</a>
to see just how simple it is to add powerful reporting capabilities and
elevate your module’s impact.</p>
</div>
<div class="section level3">
<h3 id="using-standard-widgets-in-your-custom-module">Using standard widgets in your custom module<a class="anchor" aria-label="anchor" href="#using-standard-widgets-in-your-custom-module"></a>
</h3>
<p>The <a href="https://insightsengineering.github.io/teal.widgets/latest-tag/"><code>teal.widgets</code></a>
package provides various widgets which can be leveraged to quickly
create standard elements in your custom <code>teal</code> module.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
