# Data module for `teal` transformations and output customization

**\[experimental\]**

`teal_transform_module` provides a `shiny` module that enables data
transformations within a `teal` application and allows for customization
of outputs generated by modules.

## Usage

``` r
teal_transform_module(
  ui = NULL,
  server = function(id, data) data,
  label = "transform module",
  datanames = "all"
)
```

## Arguments

- ui:

  (`function(id)`) `shiny` module UI function; must only take `id`
  argument

- server:

  (`function(id, data)` or `expression`) A `shiny` module server
  function that takes `id` and `data` as arguments, where `id` is the
  module id and `data` is the reactive `teal_data` input. The `server`
  function must return a reactive expression containing a `teal_data`
  object. For simplified syntax, use
  [`make_teal_transform_server()`](https://insightsengineering.github.io/teal/reference/make_teal_transform_server.md).

- label:

  (`character(1)`) Label of the module.

- datanames:

  (`character`) Specifies the names of datasets relevant to the module.
  Only filters for the specified `datanames` will be displayed in the
  filter panel. The keyword `"all"` can be used to display filters for
  all datasets. `datanames` are automatically appended to the
  [`modules()`](https://insightsengineering.github.io/teal/reference/teal_modules.md)
  `datanames`.

## Transforming Module Inputs in `teal`

Data transformations occur after data has been filtered in `teal`. The
transformed data is then passed to the `server` of
[`teal_module()`](https://insightsengineering.github.io/teal/reference/teal_modules.md)
and managed by `teal`'s internal processes. The primary advantage of
`teal_transform_module` over custom modules is in its error handling,
where all warnings and errors are managed by `teal`, allowing developers
to focus on transformation logic.

For more details, see the vignette:
[`vignette("transform-input-data", package = "teal")`](https://insightsengineering.github.io/teal/articles/transform-input-data.md).

## Customizing Module Outputs

`teal_transform_module` also allows developers to modify any object
created within
[`teal.data::teal_data`](https://insightsengineering.github.io/teal.data/latest-tag/reference/teal_data.html).
This means you can use it to customize not only datasets but also
tables, listings, and graphs. Some
[`teal_modules`](https://insightsengineering.github.io/teal/reference/teal_modules.md)
permit developers to inject custom `shiny` modules to enhance displayed
outputs. To manage these `decorators` within your module, use
[`ui_transform_teal_data()`](https://insightsengineering.github.io/teal/reference/module_transform_data.md)
and
[`srv_transform_teal_data()`](https://insightsengineering.github.io/teal/reference/module_transform_data.md).
(For further guidance on managing decorators, refer to `ui_args` and
`srv_args` in the vignette documentation.)

See the vignette
[`vignette("transform-module-output", package = "teal")`](https://insightsengineering.github.io/teal/articles/transform-module-output.md)
for additional examples.

## `server` as a language

The `server` function in `teal_transform_module` must return a reactive
[`teal.data::teal_data`](https://insightsengineering.github.io/teal.data/latest-tag/reference/teal_data.html)
object. For simple transformations without complex reactivity, the
`server` function might look like this:s

    function(id, data) {
      moduleServer(id, function(input, output, session) {
        reactive({
          within(
            data(),
            expr = x <- subset(x, col == level),
            level = input$level
          )
        })
      })
    }

The example above can be simplified using `make_teal_transform_server`,
where `level` is automatically matched to the corresponding `input`
parameter:

    make_teal_transform_server(expr = expression(x <- subset(x, col == level)))

## Examples in Shinylive

- example-1:

  [Open in
  Shinylive](https://shinylive.io/r/app/#code=NobwRAdghgtgpmAXGKAHVA6ASmANGAYwHsIAXOMpMAGwEsAjAJykYE8AKcqagSgB0ItMnGYFStAG5wABAB4AtNIBmAVwhjaJdj2kAVLAFUAogIEATKKSgB9UswgBnJUUYxLLh3MV0HpdgOlpLmpbeycXGGsYIjMVajh-CEDA6ih6OGppAF5pPjAAZStxAiCw51d3RmUXaVpGWgc83ADkiytoeE8cvLqGppbAhxEpKpzVdXEtWjNcaTaoHRAB5OjY+PzhkXZp2fGNKYhUFVJZomOjk+khhwdNCEXl5OlGOCgNKXYlpKefgHdaUgACyE7Hm2lmXx+UNq9U8CmkgNeZm2sNmAFZ+N9odIAL6Y7F4x64-HJHEtHjNb7BUJQRzlSKrOIJZapdKZbpgACSwlE4ikpVp4QqpBq5RhfTwy3mHTgXVyYF6jUlWOkKlo2WUan2EG2ZgeKsCji80gAcvldSSnlYAOYOAAkZkkiWxEBU8HqBG5F3Yjn8kGsxGoSop8vygKIv2kSUDbscTWkEm4KhkOTRsxgQg1AEZ01AAB4atNXciobOW5LlnGUp5DRgjDV7SY6nZzSwLaSQn6M9abRi63ZapvbQ7HU7nUdXWW3Ej67EvN58hKd7H-IEgsEUolQ5fY5KK42K4CzLOICABohBgC6W5+VZvTzPgblQgudsfF8aBp+5aehK-f9-ckBExAQzlIC5rDMOBiGYEUqnhak7EFekohiJlnUnOsRA1NwAGs4FsV4QiQukImsWsRgwwI4DzVAXhuO4qOSIh6AAK2g0hjReCR2BY9ixHLElMRA6B0APQQ-BaeYNWpMF9xyRVN2+btZQ1GjYFQeJULWZkVRIoU3DguV5hpUjhQ8atWmglxKjlHw-DAiCoJgyohOAgRaCUaRh3IXlJASHhZyuYEIFYABBdB2DQVA7TVWZortCiRExMkIDAHFLyAA)

## Examples

``` r
data_transformators <- list(
  teal_transform_module(
    label = "Static transformator for iris",
    datanames = "iris",
    server = function(id, data) {
      moduleServer(id, function(input, output, session) {
        reactive({
          within(data(), {
            iris <- head(iris, 5)
          })
        })
      })
    }
  ),
  teal_transform_module(
    label = "Interactive transformator for iris",
    datanames = "iris",
    ui = function(id) {
      ns <- NS(id)
      tags$div(
        numericInput(ns("n_cols"), "Show n columns", value = 5, min = 1, max = 5, step = 1)
      )
    },
    server = function(id, data) {
      moduleServer(id, function(input, output, session) {
        reactive({
          within(data(),
            {
              iris <- iris[, 1:n_cols]
            },
            n_cols = input$n_cols
          )
        })
      })
    }
  )
)

output_decorator <- teal_transform_module(
  server = make_teal_transform_server(
    expression(
      object <- rev(object)
    )
  )
)

app <- init(
  data = teal_data(iris = iris),
  modules = example_module(
    transformators = data_transformators,
    decorators = list(output_decorator)
  )
)
if (interactive()) {
  shinyApp(app$ui, app$server)
}
```
