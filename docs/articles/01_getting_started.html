<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with Teal • teal</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">teal</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_getting_started.html">Getting Started with Teal</a>
    </li>
    <li>
      <a href="../articles/02_reproducible-code.html">Creating Reproducible Code for teal Modules</a>
    </li>
    <li>
      <a href="../articles/10_teal_design_and_implementation.html">Teal Design and Implementation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.roche.com/Rpackages/teal">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Getting Started with Teal</h1>
                        <h4 class="author">Adrian Waddell</h4>
            
            <h4 class="date">2018-01-19</h4>
          </div>

    
    
<div class="contents">
<p><img src="images/teal.jpg" alt="Teal Duck" style="width: 100%;"></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><em>teal</em> is a shiny based interactive exploration framework for analyzing clinical trials data. <code>teal</code> currently provides a dynamic filtering facility and different data viewers. <code>teal</code> shiny applications are built using standard <a href="https://shiny.rstudio.com/articles/modules.html" title="Modularizing Shiny app code">shiny modules</a>.</p>
<p>The introduction example in this document is very basic, you can study the code for an actial application that we deployed to analyze ATEZO data. You can find that application code <a href="https://github.roche.com/waddella/atezo-pooled-analysis-shinyapp">here</a>.</p>
</div>
<div id="initializing-a-teal-application" class="section level2">
<h2 class="hasAnchor">
<a href="#initializing-a-teal-application" class="anchor"></a>Initializing A Teal application</h2>
<p>The workflow to create a shiny app using teal is as follows. The <code><a href="http://www.rdocumentation.org/packages/teal/topics/init">teal::init</a></code> function is used to create a shiny <code>server</code> and <code>ui</code> function which in turn can then be passed to the <code><a href="http://www.rdocumentation.org/packages/shiny/topics/shinyApp">shiny::shinyApp</a></code> function to start a shiny application. The following code is sufficient for a <a href="https://shiny.rstudio.com/articles/single-file.html" title="Single-file Shiny apps">single file shiny app</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(teal)

ASL &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_sample_data.html">generate_sample_data</a></span>(<span class="st">'ASL'</span>)
ARS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_sample_data.html">generate_sample_data</a></span>(<span class="st">'ARS'</span>)
ATE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_sample_data.html">generate_sample_data</a></span>(<span class="st">'ATE'</span>)

x &lt;-<span class="st"> </span>teal<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/teal/topics/init">init</a></span>(
  <span class="dt">data =</span>  <span class="kw">list</span>(<span class="dt">ASL =</span> ASL, <span class="dt">ARS =</span> ARS, <span class="dt">ATE =</span> ATE),
  <span class="dt">modules =</span> <span class="kw"><a href="../reference/root_modules.html">root_modules</a></span>(
    <span class="kw"><a href="../reference/module.html">module</a></span>(
      <span class="st">"data source"</span>,
      <span class="dt">server =</span> <span class="cf">function</span>(input, output, session, datasets) {},
      <span class="dt">ui =</span> <span class="cf">function</span>(id) <span class="kw">div</span>(<span class="kw">p</span>(<span class="st">"information about data source"</span>)),
      <span class="dt">filters =</span> <span class="ot">NULL</span>
    ),
    <span class="kw"><a href="../reference/tm_data_table.html">tm_data_table</a></span>(),
    <span class="kw"><a href="../reference/tm_variable_browser.html">tm_variable_browser</a></span>(),
    <span class="kw"><a href="../reference/modules.html">modules</a></span>(
      <span class="dt">label =</span> <span class="st">"analysis items"</span>,
      <span class="kw"><a href="../reference/tm_table.html">tm_table</a></span>(
        <span class="dt">label =</span> <span class="st">"demographic table"</span>,
        <span class="dt">dataname =</span> <span class="st">"ASL"</span>,
        <span class="dt">xvar =</span> <span class="st">"SEX"</span>,
        <span class="dt">yvar =</span> <span class="st">"RACE"</span>,
        <span class="dt">yvar_choices =</span> <span class="kw">c</span>(<span class="st">"RACE"</span>, <span class="st">"AGEGR"</span>, <span class="st">"REGION"</span>)
      ),
      <span class="kw"><a href="../reference/tm_scatterplot.html">tm_scatterplot</a></span>(
        <span class="dt">label =</span> <span class="st">"scatterplot"</span>,
        <span class="dt">dataname =</span> <span class="st">"ASL"</span>,
        <span class="dt">xvar =</span> <span class="st">"AGE"</span>,
        <span class="dt">yvar =</span> <span class="st">"BBMI"</span>,
        <span class="dt">color_by =</span> <span class="st">"_none_"</span>,
        <span class="dt">color_by_choices =</span> <span class="kw">c</span>(<span class="st">"_none_"</span>, <span class="st">"STUDYID"</span>)
      ),
      <span class="kw"><a href="../reference/module.html">module</a></span>(
        <span class="dt">label =</span> <span class="st">"survival curves"</span>,
        <span class="dt">server =</span> <span class="cf">function</span>(input, output, session, datasets) {},
        <span class="dt">ui =</span> <span class="cf">function</span>(id) <span class="kw">div</span>(<span class="kw">p</span>(<span class="st">"Kaplan Meier Curve"</span>)),
        <span class="dt">filters =</span> <span class="st">"ATE"</span>
      )
    )
  ),
  <span class="dt">header =</span> tags<span class="op">$</span><span class="kw">h1</span>(<span class="st">"Sample App"</span>),
  <span class="dt">footer =</span> tags<span class="op">$</span><span class="kw">p</span>(<span class="st">"Copyright 2017"</span>)
)

<span class="kw">shinyApp</span>(x<span class="op">$</span>ui, x<span class="op">$</span>server)</code></pre></div>
<p>This will produce the following webapp (I switched to the data table tab):</p>
<p><img src="images/simple_setup.png" alt="Simple Example Of Teal" style="width: 100%;"></p>
<p>That is, we see a web app with a navigation bar at the top, the filter elements on the right, and the data table viewer in the center. The data table and the variable browser are two items that we provide with teal. Other items can be added using shiny modules. Note that if you would like to deploy the above app to a shiny server then place the code into an <code>app.R</code> file.</p>
<p>Note that each function in the teal package is documented. Run</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(teal)
<span class="kw">help</span>(<span class="dt">package =</span> <span class="st">"teal"</span>)</code></pre></div>
<p>In the remainder of this section we will discuss all the elements that we specified to get to this application.</p>
<div id="general-layout" class="section level3">
<h3 class="hasAnchor">
<a href="#general-layout" class="anchor"></a>General Layout</h3>
<p>The following mackup shows an abstraction of the elements that are created in each teal application:</p>
<p><img src="images/teal_containers.png" alt="Simple Example Of Teal" style="width: 100%;"></p>
<p>These containers correspond to actual html block elements and we use shiny’s default layout manager <a href="http://getbootstrap.com">bootstrap 3</a> with a fluid-container. Web-app based on teal can control the following:</p>
<ul>
<li>analysis data</li>
<li>header and footer content</li>
<li>the navbar menu items that define the tab content</li>
<li>and the content in the “Tab Content” element by using <a href="https://shiny.rstudio.com/articles/modules.html">shiny modules</a>
</li>
<li>whether the filter panel is shown or not and what filters are shown</li>
</ul>
<p>And the following items can currently not be controlled:</p>
<ul>
<li>layout outside of the “Tab Contents” box</li>
<li>filter setup</li>
</ul>
</div>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<p>In the code listing above we specified the analysis data with a named list that is passed to the <code>data</code> argument of <code><a href="http://www.rdocumentation.org/packages/teal/topics/init">teal::init</a></code>. Because we filter every other data set with the ASL filters (more on this below) you always need to specify the <code>ASL</code> data with the <code>USUBJID</code> variable. Note that the dataset names are case sensitive.</p>
</div>
<div id="navigation-tabs-application-content-shiny-modules" class="section level3">
<h3 class="hasAnchor">
<a href="#navigation-tabs-application-content-shiny-modules" class="anchor"></a>Navigation Tabs, Application Content, Shiny Modules</h3>
<p>The second argument of <code><a href="http://www.rdocumentation.org/packages/teal/topics/init">teal::init</a></code> that we specified in the code listing above is the <code>modules</code> arguments. Modules define the elements displayed with tabs in the <em>Navbar</em> and their corresponding content in the <em>Tabs Content</em> box. A <code>modules</code> object can contain <code>module</code> and <code>modules</code> objects. For the app defined above this tree looks as follows:</p>
<p><img src="images/module_tree.png" alt="Navigation Tree" style="width: 100%;"></p>
<p>Note that we currently only allow a tree of depth 2 and we start the tree with the <code>root_modules</code> function which is a wrapper around <code>modules</code> that sets the <code>label</code> argument to <code>"root"</code>.</p>
<p>The <a href="https://shiny.rstudio.com/articles/modules.html" title="Modularizing Shiny app code">shiny modules</a> are specified in the <code>module</code> function with the <code>server</code> and <code>ui</code> argument. Both, <code>module</code> and <code>modules</code> are documented in the <code>teal</code> package, see <code><a href="../reference/module.html">?module</a></code> and <code><a href="../reference/modules.html">?modules</a></code>.</p>
</div>
</div>
<div id="accessing-the-analysis-data-in-shiny-modules" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-the-analysis-data-in-shiny-modules" class="anchor"></a>Accessing the Analysis Data in Shiny Modules</h2>
<p><code>teal</code> encaplulates all analysis datasets and provides the filtering facility. The filtered and unfiltered data is then made accessible via a <code>FilteredData</code> object that we usually assign to a <code>datasets</code> variable. The <code>FilteredData</code> class is based on the <a href="https://cran.r-project.org/web/packages/R6/vignettes/Introduction.html" title="Introduction to R6 classes">R6</a> object system and we initally did not intend to expose that object to the <code>teal</code> package user. Hence there are some public methods to the <code>FilteredData</code> class that are not safe to use. It’s best to only use the <code>get_data</code> method when writing <a href="https://shiny.rstudio.com/articles/modules.html" title="Modularizing Shiny app code">shiny modules</a>. The <code>get_data</code> method returns either a reactive or a static version of the filtered or unfitered dataset of interest.</p>
<p>Assume we create the following <code>module</code> with the shiny modules</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/module.html">module</a></span>(
  <span class="dt">label =</span> <span class="st">"Frequency Table"</span>,
  <span class="dt">ui =</span> <span class="cf">function</span>(id) {
    ns &lt;-<span class="st"> </span><span class="kw">NS</span>(id)
    <span class="kw">tableOutput</span>(<span class="kw">ns</span>(<span class="st">"freq_table"</span>))
  },
  <span class="dt">server =</span> <span class="cf">function</span>(input, output, session, datasets) {
    output<span class="op">$</span>freq_table &lt;-<span class="st"> </span><span class="kw">renderTable</span>({
      asl &lt;-<span class="st"> </span>datasets<span class="op">$</span><span class="kw">get_data</span>(<span class="st">"asl"</span>, <span class="dt">reactive =</span> <span class="ot">TRUE</span>, <span class="dt">filtered=</span><span class="ot">TRUE</span>)
      <span class="kw">table</span>(asl<span class="op">$</span>SEX)
    })
  }
)</code></pre></div>
<p>This analysis item shows up as <em>Frequency Table</em> in the navbar and displays a table of the <code>ASL.SEX</code> variable in the <em>Tab Contents</em> section of the app. The <code>ui</code> function requires the <code>id</code> argument, as defined in <a href="https://shiny.rstudio.com/articles/modules.html" title="Modularizing Shiny app code">shiny modules</a> and the <code>server</code> function requires the three arguments <code>input</code>, <code>output</code>, and <code>session</code>. The <code>dataset</code> argument is added to the <code>server</code> function call by <code>teal</code> based on the <code>server_args</code> argument list specified in the <code>module</code> function. The <code>server_args</code> expects a named list with additional arguments that should be passed to the server function. The list names (e.g. <code>datasets</code> in the above code) map to the argument names and the content is usually mapped one-to-one with the expection of some keywords such as <code>tead_datasets</code> which will be replaced by teal with the <code>FilteredData</code> object mentioned above. Note that when you extract a dataset from the <code>FilteredData</code> object (here associated with the <code>datasets</code> variable) then you should always use the argument <code>filtered=TRUE</code> in the <code>get_data</code> method to keep the application interaction coherent.</p>
</div>
<div id="filtering" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering" class="anchor"></a>Filtering</h2>
<p>Currently we apply a specific filtering mechanism that is useful for clinical trials data and that requires an <code>ASL</code> analysis dataset to be part of every <code>teal</code> app. That is, the filter framework provides lets the user dynamically specify which variables she/he wants to use for filtering (using ranges or categories). Teal then creates the <code>subset</code> code for each filter condition and links them with an elementwise logical <strong>AND</strong> operator (i.e. <code>&amp;</code>). Further, all datasets other then <code>ASL</code> will also be filtered with the remaining subjects in <code>ASL</code> through the <code>ASL.USUBJID</code> and <code>ASL.STUDYID</code> variables. Hence, assume you have the following three filters</p>
<ul>
<li><code>ASL.STUDYID %in% c('BP29392', 'WP29945')</code></li>
<li><code>ASL.AGE &gt; 15 &amp; ASL.AGE &lt; 35</code></li>
<li><code>ARS.ADY &gt; 0 &amp; ARS.ADY &lt; 500</code></li>
</ul>
<p>Then then <code>FiteredData</code> object will perform the following operations to obtain the filtered <code>ARS</code> object in one of your moduls:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ASL_FILTERED &lt;-<span class="st"> </span><span class="kw">subset</span>(ASL, ASL.STUDYID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">'BP29392'</span>, <span class="st">'WP29945'</span>) <span class="op">&amp;</span><span class="st"> </span>ASL.AGE <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>ASL.AGE <span class="op">&lt;</span><span class="st"> </span><span class="dv">35</span>)
ARS_FILTERED_ALONE &lt;-<span class="st"> </span><span class="kw">subset</span>(ARS, ARS.ADY <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>ARS.ADY <span class="op">&lt;</span><span class="st"> </span><span class="dv">500</span>)

ARS_FILTERED &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> ASL_FILTERED,
                      <span class="dt">y =</span> ARS_FILTERED_ALONE, 
                      <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"STUDYID"</span>), <span class="dt">all.x =</span> <span class="ot">FALSE</span>, <span class="dt">all.y =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="additional-information" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-information" class="anchor"></a>Additional Information</h2>
<div id="defining-custom-header-and-footers" class="section level3">
<h3 class="hasAnchor">
<a href="#defining-custom-header-and-footers" class="anchor"></a>Defining Custom Header and Footers</h3>
<p>The <code><a href="http://www.rdocumentation.org/packages/teal/topics/init">teal::init</a></code> function also has the <code>header</code> and <code>footer</code> arguments that expectes an object of class <code>shiny.tag</code> which can be created with the functions stored in the <code>tags</code> list (exported by shiny). So, a possible header could be defined as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tags<span class="op">$</span><span class="kw">div</span>(tags<span class="op">$</span><span class="kw">h1</span>(<span class="st">"My New Analysis Web-app"</span>), tags<span class="op">$</span><span class="kw">p</span>(<span class="dt">class=</span><span class="st">"pull-left"</span>, <span class="st">"Logo"</span>))</code></pre></div>
</div>
<div id="production-setup-and-version-control" class="section level3">
<h3 class="hasAnchor">
<a href="#production-setup-and-version-control" class="anchor"></a>Production Setup and Version Control</h3>
<p>Teal is currently under active development and features and bug-fixes get added frequently and we also reserve the freedom to change the API. You can download the latest <code>teal</code> versions from the <a href="https://github.roche.com/waddella/teal" title="Teal GitHub Repository">GithHub repository</a> and eventually we will release versions also on the <a href="http://gran.roche.com" title="Roche R Package Server">GRAN</a> server that you can install via <code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_version">devtools::install_version</a></code>.</p>
<p>I recommend not to version control your whole shiny app with <a href="https://rstudio.github.io/packrat/" title="Packrat is a dependency management system for R">packrat</a> if not necessary. In order to version control teal for your deployed shiny app you can install the teal version of choice into folder within the shiny app and then load that <code>teal</code> package explicitly. To do so we</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">ssh</span> bee.roche.com

<span class="ex">module</span> load R-library/2017Q1-gompi-2017a-R-3.3.1
<span class="ex">R</span> </code></pre></div>
<p>In R install these packages if you havent already</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">'roxygen2'</span>, <span class="st">'whiksers'</span>, <span class="st">'devtools'</span>), <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Then exit <code>R</code> with <code>q()</code> and back on the bash clone the teal repository, build it and install it locally</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="bu">cd</span> ~/
<span class="fu">git</span> clone https://github.roche.com/waddella/teal
<span class="ex">R</span> CMD BUILD teal

<span class="bu">cd</span> /srv/shiny-server/MY-APP

<span class="fu">mkdir</span> libs
<span class="ex">R</span> CMD INSTALL -l ./libs ~/teal_0.0.1.tar.gz</code></pre></div>
<p>And then in your <code>app.R</code> file in the <code>/srv/shiny-server/MY-APP</code> folder add the following code</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">.libPaths</span>(<span class="kw">c</span>(<span class="kw">normalizePath</span>(<span class="st">"./libs"</span>), <span class="kw">.libPaths</span>()))</code></pre></div>
<p>before you load the <code>teal</code> library with <code>library(teal)</code>.</p>
<p>You may also watch the video <a href="https://github.roche.com/waddella/videos/raw/master/teal/getting_started_with_teal.mp4">here</a> that explains these steps to set up a teal project.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#initializing-a-teal-application">Initializing A Teal application</a></li>
      <li><a href="#accessing-the-analysis-data-in-shiny-modules">Accessing the Analysis Data in Shiny Modules</a></li>
      <li><a href="#filtering">Filtering</a></li>
      <li><a href="#additional-information">Additional Information</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adrian Waddell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
