---
title: "Managing Reproducible Report Documents in teal"
author: "NEST CoreDev"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Managing Reproducible Report Documents in teal}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction

`teal` provides comprehensive reporting capabilities that allow users to generate reproducible documents from their analysis modules. This vignette covers the key components for managing report documents in `teal` applications.

The reporting system offers three levels of control:

1. **Global reporting control** via the `reporter` parameter in `init()`
2. **Module-level control** using `disable_report()` to exclude specific modules  
3. **Report customization** with the `after` function to enhance report content

This vignette demonstrates how to use these features effectively to create flexible and customized reporting workflows.

## Global and Local Reporting Control

##### 1. Default Reporting (parameter omitted)
When you don't specify the `reporter` parameter, `teal` automatically enables default reporting functionality:

```{r default_reporting}
# Default reporting - automatically enabled
app_default <- init(
  data = teal_data(IRIS = iris, MTCARS = mtcars),
  modules = modules(
    example_module("Analysis 1"),
    example_module("Analysis 2")
  )
)
```

With default reporting enabled:
- A "Report previewer" tab is automatically added to your application
- Users can add module outputs to reports and download them
- Reports include reproducible code for all analyses

##### 2. Disabled Reporting (`reporter = NULL`)
To completely disable reporting functionality across your entire application:

```{r disabled_reporting}
# Reporting disabled - no report functionality available
app_no_reporting <- init(
  data = teal_data(IRIS = iris, MTCARS = mtcars),
  modules = modules(
    example_module("Analysis 1"),
    example_module("Analysis 2")
  ),
  reporter = NULL
)
```

When `reporter = NULL`:
- No "Report previewer" tab appears
- Modules cannot add content to reports
- All reporting-related UI elements are hidden

##### 3. Custom Reporter 
For advanced use cases, you can provide a custom initial reporter object:

```{r custom_reporter}
library(teal.reporter)

# Create a custom reporter with specific configuration
custom_reporter <- teal.reporter::Reporter$new()

# Use the custom reporter in your app
app_custom <- init(
  data = teal_data(IRIS = iris, MTCARS = mtcars),
  modules = modules(
    example_module("Analysis 1"),
    example_module("Analysis 2")
  ),
  reporter = custom_reporter
)
```

#### Module-Level Reporting Control

While the `reporter` parameter controls reporting globally, you can also disable reporting for specific modules using `disable_report()`. This allows you to have fine-grained control over which modules support reporting:

```{r module_level_control}
# App with global reporting enabled, but specific modules excluded
app_selective <- init(
  data = teal_data(IRIS = iris, MTCARS = mtcars),
  modules = modules(
    example_module("Analysis 1"),                   # Reporting enabled
    disable_report(example_module("Analysis 2")),   # Reporting disabled for this module
    example_module("Analysis 3")                    # Reporting enabled
  )
)
```

In this example:
- "Analysis 1" and "Analysis 3" modules can add content to reports
- "Analysis 2" module cannot add content to reports (no "Add to Report" buttons appear)
- The "Report previewer" tab is still available since reporting is globally enabled

#### Choosing the Right Configuration

* **Use default reporting** (omit parameter) for most applications where you want standard reporting functionality
* **Use `reporter = NULL`** when you want to disable reporting entirely, perhaps for:
  - Demo applications
  - Apps where reporting is not needed
  - Performance-critical applications
* **Use a custom reporter** when you need:
  - Special report formatting
  - Custom report templates
  - Integration with external reporting systems
* **Use `disable_report()`** for individual modules when you want:
  - Most modules to support reporting but exclude specific ones
  - To disable reporting for modules that don't produce meaningful report content
  - Fine-grained control over the reporting experience


## Adjusting the Report Card

### Using the `after` Function to Customize Module Report Cards

The `after` function in `teal` provides a mechanism to customize and enhance the report cards generated by modules. This function allows you to inject additional content, modify existing content, or perform post-processing operations on report cards before they are finalized.

#### Understanding the `after` Function

The `after` function is typically used within module definitions to specify custom logic that should be executed after the module's standard report card is created. This enables you to:

- Add custom text, plots, or tables to the report
- Modify the formatting or structure of the report card
- Include additional metadata or context
- Perform validation or quality checks on the report content

#### Basic Usage Pattern

```{r after_basic_usage}
# Example module with custom report card adjustment
app_after <- init(
  data = teal_data(IRIS = iris, MTCARS = mtcars),
  modules = modules(
    example_module("Analysis 1") |> 
      after(server = function(input, output, session, data) {
        teal_card(data()) <- teal_card(data(), "## Custom Analysis Summary", head(iris))
        return(data)
      })
  )
)
```